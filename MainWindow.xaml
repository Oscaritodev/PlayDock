<Window x:Class="NewLauncher.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:NewLauncher"
        xmlns:vm="clr-namespace:NewLauncher.ViewModels"
        mc:Ignorable="d"
        Title="Launcher" Height="720" Width="1280"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None" ResizeMode="NoResize"
        Background="#121212">
    
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <!-- Fade In Animation Helper -->
        <Storyboard x:Key="FadeInDetails">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.3"/>
        </Storyboard>
    </Window.Resources>

    <Grid>
        <!-- Background Blur -->
        <Grid>
            <Image Source="{Binding SelectedGame.Icon}" Stretch="UniformToFill" Opacity="0.1">
                <Image.Effect>
                    <BlurEffect Radius="60"/>
                </Image.Effect>
            </Image>
            <Rectangle Fill="#E6121212"/>
        </Grid>

        <!-- Main Layout -->
        <Grid Margin="40">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Top Bar -->
            <Grid Grid.Row="0" Margin="0,0,0,20">
                <StackPanel Orientation="Horizontal">
                    <Ellipse Width="32" Height="32" Fill="#333" Stroke="White" StrokeThickness="1"/>
                    <TextBlock Text="User" Foreground="White" VerticalAlignment="Center" Margin="10,0,0,0"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                     <Button Command="{Binding AddGameCommand}" Content="+ ADD" Background="#333" Foreground="White" BorderThickness="0" Padding="15,5" FontWeight="Bold">
                        <Button.Resources>
                            <Style TargetType="Border"><Setter Property="CornerRadius" Value="15"/></Style>
                        </Button.Resources>
                    </Button>
                    <TextBlock Text="{Binding CurrentTime}" Foreground="White" VerticalAlignment="Center" Margin="20,0,0,0" FontWeight="Bold"/>
                </StackPanel>
            </Grid>

            <!-- Center List -->
            <Grid Grid.Row="1">
                <ListBox ItemsSource="{Binding Games}" 
                         SelectedItem="{Binding SelectedGame}"
                         HorizontalAlignment="Center" 
                         VerticalAlignment="Center"
                         Background="Transparent" 
                         BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         ScrollViewer.VerticalScrollBarVisibility="Hidden">
                         
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Vertical" HorizontalAlignment="Center"/>
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Margin" Value="0,10"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Grid x:Name="RootGrid" RenderTransformOrigin="0.5,0.5">
                                            <Grid.RenderTransform>
                                                <ScaleTransform x:Name="ScaleTrans" ScaleX="1" ScaleY="1"/>
                                            </Grid.RenderTransform>
                                            
                                            <!-- Animated Wrapper -->
                                            <Border x:Name="ContainerBorder" 
                                                    Background="#1A1A1A" 
                                                    CornerRadius="12" 
                                                    Padding="0"
                                                    Width="70" Height="70"
                                                    ClipToBounds="True">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/> <!-- Icon -->
                                                        <ColumnDefinition Width="*"/>    <!-- Details (Hidden primarily) -->
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Icon (Always Visible) -->
                                                    <Image Source="{Binding Icon}" 
                                                           Width="50" Height="50" 
                                                           Margin="10" 
                                                           Stretch="Uniform"
                                                           HorizontalAlignment="Center" VerticalAlignment="Center"
                                                           RenderOptions.BitmapScalingMode="HighQuality"/>

                                                    <!-- Details Panel (Visible on Expand) -->
                                                    <Grid x:Name="DetailsGrid" Grid.Column="1" Opacity="0" Visibility="Collapsed" Margin="10,10,20,10">
                                                        <StackPanel VerticalAlignment="Center" Width="300">
                                                            <Grid>
                                                                <TextBlock Text="{Binding Title}" Foreground="White" FontSize="20" FontWeight="Bold" TextTrimming="CharacterEllipsis" MaxWidth="250" HorizontalAlignment="Left"/>
                                                                <Button Command="{Binding DataContext.EditGameCommand, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                                        CommandParameter="{Binding}"
                                                                        HorizontalAlignment="Right" VerticalAlignment="Top"
                                                                        Background="Transparent" BorderThickness="0" Padding="5" Margin="0,-5,-5,0">
                                                                    <TextBlock Text="✏️" Foreground="#888" FontSize="12"/>
                                                                </Button>
                                                            </Grid>
                                                            
                                                            <TextBlock Text="{Binding Description}" Foreground="#BBB" TextWrapping="Wrap" MaxHeight="60" Margin="0,5,0,10" FontSize="12"/>
                                                            
                                                            <Button Command="{Binding DataContext.PlayGameCommand, RelativeSource={RelativeSource AncestorType=Window}}" 
                                                                    CommandParameter="{Binding}"
                                                                    Content="PLAY" 
                                                                    Background="White" Foreground="Black" 
                                                                    Width="100" Height="30" 
                                                                    HorizontalAlignment="Left" 
                                                                    FontWeight="Bold">
                                                                <Button.Resources>
                                                                    <Style TargetType="Border"><Setter Property="CornerRadius" Value="15"/></Style>
                                                                </Button.Resources>
                                                            </Button>
                                                        </StackPanel>
                                                    </Grid>
                                                </Grid>
                                            </Border>
                                        </Grid>
                                        
                                        <ControlTemplate.Triggers>
                                            <!-- ANIMATIONS -->
                                            <MultiTrigger>
                                                <MultiTrigger.Conditions>
                                                    <Condition Property="IsMouseOver" Value="True"/>
                                                </MultiTrigger.Conditions>
                                                <MultiTrigger.EnterActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <!-- Expand Width -->
                                                            <DoubleAnimation Storyboard.TargetName="ContainerBorder" Storyboard.TargetProperty="Width" To="400" Duration="0:0:0.2">
                                                                <DoubleAnimation.EasingFunction>
                                                                    <CubicEase EasingMode="EaseOut"/>
                                                                </DoubleAnimation.EasingFunction>
                                                            </DoubleAnimation>
                                                            <!-- Expand Height -->
                                                            <DoubleAnimation Storyboard.TargetName="ContainerBorder" Storyboard.TargetProperty="Height" To="180" Duration="0:0:0.2">
                                                                <DoubleAnimation.EasingFunction>
                                                                    <CubicEase EasingMode="EaseOut"/>
                                                                </DoubleAnimation.EasingFunction>
                                                            </DoubleAnimation>
                                                            <!-- Increase Icon Size slightly/Move it? Keep it simple for now -->
                                                            
                                                            <!-- Show Details -->
                                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="DetailsGrid" Storyboard.TargetProperty="Visibility" Duration="0:0:0.1">
                                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.1" Value="{x:Static Visibility.Visible}"/>
                                                            </ObjectAnimationUsingKeyFrames>
                                                            <DoubleAnimation Storyboard.TargetName="DetailsGrid" Storyboard.TargetProperty="Opacity" To="1" BeginTime="0:0:0.1" Duration="0:0:0.2"/>
                                                            
                                                            <!-- Change Background -->
                                                            <ColorAnimation Storyboard.TargetName="ContainerBorder" Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)" To="#252525" Duration="0:0:0.2"/>
                                                            
                                                            <!-- Select Item Logic: We can't easily auto-select in pure style triggers without side effects, 
                                                                 but we can make it visually selected. -->
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </MultiTrigger.EnterActions>
                                                <MultiTrigger.ExitActions>
                                                    <BeginStoryboard>
                                                        <Storyboard>
                                                            <!-- Collapse Width -->
                                                            <DoubleAnimation Storyboard.TargetName="ContainerBorder" Storyboard.TargetProperty="Width" To="70" Duration="0:0:0.2"/>
                                                            <!-- Collapse Height -->
                                                            <DoubleAnimation Storyboard.TargetName="ContainerBorder" Storyboard.TargetProperty="Height" To="70" Duration="0:0:0.2"/>
                                                            
                                                            <!-- Hide Details -->
                                                            <DoubleAnimation Storyboard.TargetName="DetailsGrid" Storyboard.TargetProperty="Opacity" To="0" Duration="0:0:0.1"/>
                                                            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="DetailsGrid" Storyboard.TargetProperty="Visibility" Duration="0:0:0.2">
                                                                <DiscreteObjectKeyFrame KeyTime="0:0:0.2" Value="{x:Static Visibility.Collapsed}"/>
                                                            </ObjectAnimationUsingKeyFrames>
                                                            
                                                            <!-- Revert Background -->
                                                            <ColorAnimation Storyboard.TargetName="ContainerBorder" Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)" To="#1A1A1A" Duration="0:0:0.2"/>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </MultiTrigger.ExitActions>
                                            </MultiTrigger>
                                            
                                            <!-- Also Expand if Selected (so keyboard nav works or clicking keeps it open) -->
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="ContainerBorder" Property="Width" Value="400"/>
                                                <Setter TargetName="ContainerBorder" Property="Height" Value="180"/>
                                                <Setter TargetName="DetailsGrid" Property="Visibility" Value="Visible"/>
                                                <Setter TargetName="DetailsGrid" Property="Opacity" Value="1"/>
                                                <Setter TargetName="ContainerBorder" Property="Background" Value="#252525"/>
                                            </Trigger>

                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>
            </Grid>
        </Grid>
    </Grid>
</Window>
